<!DOCTYPE html> <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1.0"> <title>密码锁 - riteme.site</title> <link rel="shortcut icon" href="/favicon.png" type="image/png"> <link rel=stylesheet  href="/styles/material-icons.css"> <link rel=stylesheet  href="/styles/material.min.css" > <link rel=stylesheet  href="/styles/gitment.css"> <link rel=stylesheet  href="/math-renderer/katex/katex.min.css"> <link rel=stylesheet  href="/styles/site.css"> <script src="/scripts/jquery.min.js"></script> <script src="/scripts/js-cookie.js"></script> <script src="/scripts/quicklink.umd.js"></script> <script defer src="/scripts/material.min.js"></script> <script src="/scripts/site.js"></script> <script src="/scripts/gitment.js"></script> <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header"> <header class=mdl-layout__header > <div class=mdl-layout__header-row > <span class=mdl-layout-title >密码锁</span> <div class=mdl-layout-spacer ></div> <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right"> <label class="mdl-button mdl-js-button mdl-button--icon" for=fixed-header-drawer-exp ><i class=material-icons >search</i></label> <div class=mdl-textfield__expandable-holder > <form action="/search.html"><input type=text  class=mdl-textfield__input  placeholder="Search Here" name=q  id=fixed-header-drawer-exp  autocomplete=off  required></form> </div> </div> </div> </header> <div class=mdl-layout__drawer > <span class="mdl-layout-title drawer-title"> <a href="/index.html" style="color: inherit; font-weight: inherit;text-decoration: none;"><img src="/favicon.png" width=32 height=32> riteme.site</a> </span> <nav class=mdl-navigation > <a class=mdl-navigation__link  href="/index.html"><i class="material-icons drawer-icon">home</i> 首页</a> <a class=mdl-navigation__link  href="/posts.html"><i class="material-icons drawer-icon">library_books</i> 所有文章</a> <a class=mdl-navigation__link  href="/about.html"><i class="material-icons drawer-icon">info</i> 关于</a> <a class=mdl-navigation__link  href="/links.html"><i class="material-icons drawer-icon">link</i> 友链</a> <a class=mdl-navigation__link  href="/search.html"><i class="material-icons drawer-icon">search</i> 搜索</a> <a class=mdl-navigation__link  href="https://github.com/riteme/riteme.github.io"><i class="material-icons drawer-icon">class</i> GitHub 项目</a> </nav> </div> <main class=mdl-layout__content > <div class=mdl-grid > <div class="mdl-cell main-cell"> <div class="article main-article" lang=en-US > <h1 id=expressioncppinout >密码锁 (expression.cpp/in/out)</h1> <p>时间限制: 1 s / 内存限制: 512 MB / 打开O2优化</p> <h2 id=_1 >题目描述</h2> <p>dyx在家里玩耍时发现了一个神奇的密码锁。然而他早已忘记了这个锁的密码，于是他随便尝试了一下，结果锁就打开了......<br /> 锁的内部有一个很长的字符串，机智的dyx马上就发现这就是密码锁的核心。于是他研究了一下午，探寻这把锁的奥秘。<br /> 他发现这个字符串是一个表达式的形式，像下面这个样子：</p> <table class=codehilitetable ><tr><td class=linenos ><div class=linenodiv ><pre>1</pre></div><td class=code ><div class=codehilite ><pre><span></span>a|b&amp;(!c^d)
</pre></div> </table> <p>其中，每一个由小写字母组成的单词是一个变量，对应着密码锁上的一个按钮。由于按钮只能按下或不按下，于是你可以认为每个变量是一个布尔类型的（即只有<tex>$\text{true}$</tex>和<tex>$\text{false}$</tex>之分）<br /> 其余的字符就只有<code>&amp;</code>、<code>|</code>、<code>^</code>、<code>!</code>和左右小括号。dyx发现括号是用来优先运算的，意思是这是一个会将所有变量进行计算的表达式，并且优先计算括号中的子表达式。同时，<code>&amp;</code>、<code>|</code>、<code>^</code>、<code>!</code>都是运算符，它们分别对应的是<strong>逻辑与</strong>、<strong>逻辑或</strong>、<strong>逻辑异或</strong>和<strong>逻辑非</strong>。其中前三者运算优先级一致，当它们在同一级出现时会从左至右运算，逻辑非的优先级比它们高。当每一个变量都有相应的值时，整个表达式就会就会进行计算，并给出一个布尔值。dyx还发现，当整个表达式的值为<tex>$\text{true}$</tex>时，密码锁就会打开。<br /> 很明显，整个密码锁的输入方案共有<tex>$2^n$</tex>种，其中<tex>$n$</tex>是表达式中变量的数量。于是dyx瞬间明白为什么他一次就可以将这个密码锁解开了。然而dyx是一个勇于探究的人，他想知道到底有多少中方法可以解开一个密码锁。<br /> 不知为何，dyx又发现了一火车的密码锁。坚持不懈的dyx不停的计算着每一个密码锁能解开的方案数......由于密码锁的表达式越来越长并且人脑计算量是<tex>$\Theta(1)$</tex>的，dyx不得不需要一个程序来帮助他计算这个方案数。</p> <h2 id=_2 >输入格式</h2> <p>每个测试数据点有多个表达式。文件以<code>EOF</code>结束。<br /> 每一个表达式占一行，且中间只有小写字母和<code>&amp;</code>、<code>|</code>、<code>^</code>、<code>!</code>、<code>(</code>、<code>)</code>。<br /> 对于<code>&amp;</code>、<code>|</code>和<code>^</code>运算，它们左右会各有一个变量或子表达式。其运算规则如下：</p> <table> <thead> <tr> <th align=center ><tex>$a$</tex> <th align=center ><tex>$b$</tex> <th align=center ><tex>$a$</tex> <code>&amp;</code> <tex>$b$</tex> (<tex>$a \land b$</tex>) <tr> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{true}$</tex> <tr> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{false}$</tex> <tr> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{false}$</tex> <tr> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{false}$</tex> </table> <table> <thead> <tr> <th align=center ><tex>$a$</tex> <th align=center ><tex>$b$</tex> <th align=center ><tex>$a$</tex> <code>|</code> <tex>$b$</tex> (<tex>$a \lor b$</tex>) <tr> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{true}$</tex> <tr> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{true}$</tex> <tr> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{true}$</tex> <tr> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{false}$</tex> </table> <table> <thead> <tr> <th align=center ><tex>$a$</tex> <th align=center ><tex>$b$</tex> <th align=center ><tex>$a$</tex> <code>^</code> <tex>$b$</tex> (<tex>$a \oplus b$</tex>) <tr> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{fasle}$</tex> <tr> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{true}$</tex> <tr> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{true}$</tex> <tr> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{false}$</tex> </table> <p>对于<code>!</code>运算，它后面会有一个变量或子表达式。其运算规则如下：</p> <table> <thead> <tr> <th align=center ><tex>$a$</tex> <th align=center >!<tex>$a$</tex> (<tex>$\lnot a$</tex>) <tr> <td align=center ><tex>$\text{true}$</tex> <td align=center ><tex>$\text{false}$</tex> <tr> <td align=center ><tex>$\text{false}$</tex> <td align=center ><tex>$\text{true}$</tex> </table> <p>输入保证表达式是有效的，且表达式中不存在缺少参数的运算符和空的括号。<br /> 为了防止此题变成不可做的NP-hard问题，输入保证表达式中每一个变量名只出现一次。</p> <h2 id=_3 >输出格式</h2> <p>对于每一个表达式，输出能够解开它的方案总数。由于答案可能过大，因此将答案对<tex>$10^9 + 7$</tex>取模后输出。<br /> 一种方案即指对每一个变量给定一个值。<br /> 两种方案不同当且仅当至少一个变量所给定的值不同。</p> <h2 id=_4 >输入样例</h2> <table class=codehilitetable ><tr><td class=linenos ><div class=linenodiv ><pre>1
2
3</pre></div><td class=code ><div class=codehilite ><pre><span></span>a&amp;b
a|b|c
a|!(b|c)
</pre></div> </table> <h2 id=_5 >输出样例</h2> <table class=codehilitetable ><tr><td class=linenos ><div class=linenodiv ><pre>1
2
3</pre></div><td class=code ><div class=codehilite ><pre><span></span>1
7
5
</pre></div> </table> <h2 id=_6 >数据范围及提示</h2> <p>对于第一个表达式，只有<tex>$a = \text{true}, b = \text{true}$</tex>才为<tex>$\text{true}$</tex>。<br /> 对于第二个表达式，只要三者有一个变量为<tex>$\text{true}$</tex>就是<tex>$\text{true}$</tex>。<br /> 对于第三个表达式，先运算<code>b|c</code>，然后对其取反，最后与<tex>$a$</tex>做逻辑与。</p> <p>以下<tex>$n$</tex>表示变量数量，<tex>$T$</tex>表示测试数据组数，<tex>$L$</tex>表示表达式的总长度。<br /> 对于<tex>$10\%$</tex>的数据，<tex>$n \le 10,\; T = 15$</tex>。<br /> 对于另外<tex>$10\%$</tex>的数据，只有逻辑或运算，没有括号。<br /> 对于另外<tex>$10\%$</tex>的数据，不存在逻辑非和括号。<br /> 对于另外<tex>$20\%$</tex>的数据，不存在括号。<br /> 对于另外<tex>$20\%$</tex>的数据，<tex>$n \le 500$</tex>。<br /> 对于<tex>$100\%$</tex>的数据，变量名长度<tex>$\le 4$</tex>，<tex>$L \le 10^6$</tex>，<tex>$n \le 3\times10^5$</tex>。<br /> 其中<tex>$90\%$</tex>的数据，<tex>$T \le 5$</tex>。</p> <hr/> <div id=comments ></div> <script> window.addEventListener('load', () => { quicklink(); }); const gitment = new Gitment({id: '48752ac12cf5c3e9f45770a4b8656290', owner: 'riteme', repo: 'riteme.github.io', oauth: { client_id: 'd4fcffa25858a7a58e1a', client_secret: 'e0c8e08beb95497871f8355416c69390634cec76' }, perPage: 10, }); gitment.render('comments'); </script> </div> </div> <div class="mdl-cell sidebar"> <div class=article > <div class="mdl-card mdl-shadow--2dp sidebar-card"> <div class="mdl-card__actions sidebar-title">页面信息</div> <div class=mdl-card__supporting-text > 标签: <a href="/search.html?q=Problems"><span class=label >Problems</span></a><br/> 创建时间: 2016.06.30<br/> 上次修改: 2016.06.30<br/> 字数统计: 2541 字 / 约 10 分钟 </div> </div> <br/> <div class="mdl-card mdl-shadow--2dp sidebar-card"> <div class="mdl-card__actions sidebar-title">数学公式渲染</div> <div class=mdl-card__supporting-text > <form name=mathopt > <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for=option-1 > <input type=radio  id=option-1  class=mdl-radio__button  name=sel  value=mathjax > <span class=mdl-radio__label >MathJax</span> </label><br/> <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for=option-2 > <input type=radio  id=option-2  class=mdl-radio__button  name=sel  value=katex > <span class=mdl-radio__label >KaTeX</span> </label> <div id=tip-2 > <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for=option-3 > <input type=radio  id=option-3  class=mdl-radio__button  name=sel  value="katex&mathjax"> <span class=mdl-radio__label >Mixed</span> </label> </div> </form> </div> </div> <div class=mdl-tooltip  data-mdl-for=tip-2 >先使用 KaTeX 渲染，再使用 MathJax 渲染</div> <br/> <div class="nano mdl-card mdl-shadow--2dp sidebar-card"> <a class=nano-ref  target=_new  href="http://nichijou.wikia.com/wiki/Nano_Shinonome"></a> <div class=mdl-card__actions > <div class=nano-shell ><span class=shell-start >$</span> nano <a href="https://github.com/riteme/riteme.github.io/blob/master/blog/2016-6-30/expression.md" id=nano-link >expression.md</a></div> </div> </div> <div class=mdl-tooltip  data-mdl-for=nano-link >查看原始 Markdown 文档</div> </div> </div> </div> <footer class=mdl-mega-footer > <div class=mdl-mega-footer__middle-section > <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h1 class=mdl-mega-footer__heading >RITEME.SITE</h1><del>一个从不乱说话的博客</del> </div> <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h1 class=mdl-mega-footer__heading >POWERED BY</h1> <ul class=mdl-mega-footer__link-list > <li><a href="http://pythonhosted.org/Markdown/">Python Markdown</a> <li><a href="http://getmdl.io/">Material Design Lite</a> <li><a href="http://www.tipue.com/search/">Tipuesearch</a> <li><a href="http://www.mathjax.org/">MathJax</a> & <a href="http://khan.github.io/KaTeX/">KaTeX</a> <li><a href="https://github.com/imsun/gitment">Gitment</a> </ul> </div> <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h1 class=mdl-mega-footer__heading >友情链接</h1> <ul class=mdl-mega-footer__link-list > <li><a href="http://ruanx.pw/">ruanxingzhi</a> <li><a href="https://blog.xehoth.cc/">xehoth</a> <li><a href="http://hjwjbsr.is-programmer.com/">HJWJBSR</a> <li><a href="http://www.micdz.cn/">MicDZ</a> <li><a href="https://cmxrynp.github.io/">CMXRYNP</a> <li><a href="http://memset0.cn/">memset0</a> </ul> </div> </div> <div class=mdl-mega-footer__bottom-section >Theme based on <a href="https://getmdl.io/">MDL</a> | Copyright © 2015-2019 riteme. All rights reserved.</div> </footer> </main> </div>