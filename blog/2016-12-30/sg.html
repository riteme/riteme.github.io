<!DOCTYPE html> <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1.0"> <title>公平组合游戏 - riteme.site</title> <link rel="shortcut icon" href="/favicon.png" type="image/png"> <link rel=stylesheet  href="/material/material-icons.css"> <link rel=stylesheet  href="/material/material.min.css" > <link rel=stylesheet  href="/gitment/gitment.css"> <link rel=stylesheet  href="/math-renderer/katex/katex.min.css"> <link rel=stylesheet  href="/css/site.css"> <script src="/js/jquery.min.js"></script> <script src="/js/jump.js"></script> <script src="/js/js-cookie.js"></script> <script src="/js/quicklink.umd.js"></script> <script defer src="/material/material.min.js"></script> <script src="/js/selector.js"></script> <script src="/gitment/gitment.js"></script> <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header"> <header class=mdl-layout__header > <div class=mdl-layout__header-row > <span class=mdl-layout-title >公平组合游戏</span> <div class=mdl-layout-spacer ></div> <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right"> <label class="mdl-button mdl-js-button mdl-button--icon" for=fixed-header-drawer-exp ><i class=material-icons >search</i></label> <div class=mdl-textfield__expandable-holder > <form action="/search.html"><input type=text  class=mdl-textfield__input  placeholder="Search Here" name=q  id=fixed-header-drawer-exp  autocomplete=off  required></form> </div> </div> </div> </header> <div class=mdl-layout__drawer > <span class="mdl-layout-title drawer-title"> <a href="/index.html" style="color: inherit; font-weight: inherit;text-decoration: none;"><img src="/favicon.png" width=32 height=32> riteme.site</a> </span> <nav class=mdl-navigation > <a class=mdl-navigation__link  href="/index.html"><i class="material-icons drawer-icon">home</i> 首页</a> <a class=mdl-navigation__link  href="/posts.html"><i class="material-icons drawer-icon">library_books</i> 所有文章</a> <a class=mdl-navigation__link  href="/about.html"><i class="material-icons drawer-icon">info</i> 关于</a> <a class=mdl-navigation__link  href="/links.html"><i class="material-icons drawer-icon">link</i> 友链</a> <a class=mdl-navigation__link  href="/search.html"><i class="material-icons drawer-icon">search</i> 搜索</a> <a class=mdl-navigation__link  href="https://github.com/riteme/riteme.github.io"><i class="material-icons drawer-icon">class</i> GitHub 项目</a> </nav> </div> <main class=mdl-layout__content > <div class=mdl-grid > <div class="mdl-cell main-cell"> <div class="article main-article" lang=en-US > <h1 id=_1 >公平组合游戏</h1> <p>应该是2016年的最后一篇博客了，Goodbye 2016！</p> <h2 id=_2 >定义</h2> <p><strong>公平组合游戏</strong>与平常的游戏类似，但是需要满足以下要求：</p> <ol> <li>有两个玩家轮流行动。 <li>双方的游戏方式一致。 <li>双方均知道游戏的完整信息。 <li>以玩家无法行动为游戏结束。 <li>游戏在有限步数内结束，并且一定能分出胜负。 </ol> <p>经典的Nim游戏就是公平组合游戏的代表，但是围棋、象棋以及井字棋这些不属于，因为这三种双方的行动不同。而且像井字棋，可能存在平局。</p> <h2 id=nim >简单Nim游戏</h2> <p>现在通过一个简单的Nim游戏来介绍一些概念。这个Nim游戏规定如下：</p> <ol> <li>一开始有<tex>$n$</tex>个石子。 <li>双方轮流取石子，必须取一颗或两颗。 <li>无法取石子者失败。 </ol> <p>对于这个游戏，我们想知道，在双方都十分聪明的情况下，先手/后手是否必胜。或者给出一个必胜的策略。</p> <p>我们可以简单分析一下。以先手为例，如果没有石子，那么一开场就算输。如果只有一颗或两颗石子，那么先手可以马上取走并获得胜利。然而，当有<tex>$3$</tex>颗石子时，你会发现无论怎么取，先手都会输掉比赛，因为无法一次取走所有的石子，而后手在你取完一次之后，相当于变成了石子数为<tex>$1$</tex>或<tex>$2$</tex>的先手，那么后手必赢。</p> <p>实际上，当<tex>$n \;\mathrm{mod}\; 3 = 0$</tex>的时候，先手会必输，否则后手必输，此时先手只用保证每次自己取完之后石子的数量都是<tex>$3$</tex>的倍数即可。</p> <h2 id=_3 >必胜与必败</h2> <p>我们规定一个<strong>位置</strong> (例如上面的Nim游戏中石子的个数) 是<tex>$\mathrm{N}$</tex>点是当此时先手的人必胜的位置，而<tex>$\mathrm{P}$</tex>点则是此时先手的人必输的位置<sup id="fnref:n-and-p"><a class=footnote-ref  href="#fn:n-and-p" rel=footnote >1</a></sup>。例如，当<tex>$n = 0$</tex>时 (下面简写为<tex>$0$</tex>)，先手是必输的。因此<tex>$0$</tex>是<tex>$\mathrm{P}$</tex>点。而在<tex>$1$</tex>和<tex>$2$</tex>时，先手会必胜，所以它们是<tex>$\mathrm{N}$</tex>点。</p> <p>简单分析可知：</p> <ol> <li>终止位置是<tex>$\mathrm{P}$</tex>点。 <li>所能到达的位置都是<tex>$\mathrm{N}$</tex>点的位置是<tex>$\mathrm{P}$</tex>点。 <li>能够到达<tex>$\mathrm{P}$</tex>点的位置是<tex>$\mathrm{N}$</tex>点。 </ol> <p>例如，在<tex>$3$</tex>这个位置，取走一个石子会到达<tex>$2$</tex>这个位置，取走两个石子会到达<tex>$1$</tex>这个位置，而这两个位置都是<tex>$\mathrm{N}$</tex>点，所以<tex>$3$</tex>是<tex>$\mathrm{P}$</tex>点。因此<tex>$3$</tex>个石子时先手必败。</p> <h2 id=_4 >图的表示</h2> <p>如果将每个位置用点表示，而位置之间的转移用有向边表示，那么<tex>$0$</tex>到<tex>$3$</tex>之间的关系可以由下图表示：</p> <p><img alt=nim  src="https://git.oschina.net/riteme/blogimg/raw/master/sg/nim.svg" /></p> <p>由于游戏是有限步数的，所以这张图必须是<strong>拓扑图</strong>。在这图上，我们可以将所有没有出边的点标记为<tex>$\mathrm{P}$</tex>点，然后根据上面的规则就可以辨识所有的位置是<tex>$\mathrm{N}$</tex>点还是<tex>$\mathrm{P}$</tex>点。由此也可以看出，一个公平组合游戏必定能分出胜负。</p> <h2 id=sprague-grundy >Sprague-Grundy定理</h2> <p>现在我们将位置用图<tex>$G(V, E)$</tex>上的点表示，对于一个点<tex>$u$</tex>，那么定义它的SG函数<tex>$g$</tex>为：<br /> <tex>$$ g(u) = \mathrm{mex}(\{g(v) : \forall (u, v) \in E\}) $$</tex></p> <p><tex>$\mathrm{mex}$</tex>是定义域在集合上的函数，返回这个集合中<strong>最小的没出现过的非负整数</strong>。<br /> 例如：<br /> <tex>$$ \begin{aligned} &amp; \mathrm{mex}(\varnothing) &amp; = 0 \\ &amp; \mathrm{mex}(\{0\}) &amp; = 1 \\ &amp; \mathrm{mex}(\{0, 1, 2, 4, 5\}) &amp; = 3 \end{aligned} $$</tex></p> <p>因此，对于没有出边的点，其<tex>$g$</tex>值为<tex>$0$</tex>。另一方面，这些点都是<tex>$\mathrm{P}$</tex>点。如果我们计算之前出现的图中的<tex>$g$</tex>值：</p> <p><img alt=sg-values  src="https://git.oschina.net/riteme/blogimg/raw/master/sg/sg-1.svg" /></p> <p>上图中<tex>$0$</tex>和<tex>$3$</tex>都是<tex>$0$</tex>，<tex>$1$</tex>和<tex>$2$</tex>都不是<tex>$0$</tex>。十分巧合的是，<tex>$0$</tex>和<tex>$3$</tex>是<tex>$\mathrm{P}$</tex>点，<tex>$1$</tex>和<tex>$2$</tex>是<tex>$\mathrm{N}$</tex>点。</p> <p>对此，我们可以证明下面一点：</p> <blockquote> <p>位置<tex>$p$</tex>是<tex>$\mathrm{P}$</tex>点当且仅当<tex>$g(p) = 0$</tex>。</p> </blockquote> <p><strong>证明</strong>：首先对于没有出边的点，它们是<tex>$\mathrm{P}$</tex>点，并且其<tex>$g$</tex>值为<tex>$0$</tex>。同时，所有能到达的这些点的点，其<tex>$g$</tex>值<tex>$\gt 0$</tex>，并且为<tex>$\mathrm{N}$</tex>点。<br /> 对于其他的点，如果是<tex>$\mathrm{N}$</tex>点，那么它一定能到达一个<tex>$\mathrm{P}$</tex>点，所以其<tex>$g$</tex>值不能为<tex>$0$</tex>。如果是<tex>$\mathrm{P}$</tex>点，那么它所能到达的点都是<tex>$\mathrm{N}$</tex>点，这些点中没有谁的<tex>$g$</tex>值是<tex>$0$</tex>，所以其<tex>$g$</tex>值为<tex>$0$</tex>。</p> <p>这样我们拥有了一个量化胜负的函数。但是对于上面这个简单Nim游戏并没有什么好处，因为上面的计算完全可以利用逻辑运算而不需要计算什么<tex>$\mathrm{mex}$</tex>。</p> <p>多数情况下，你所见到的所谓Nim游戏并没有这么简单：它通常有许多堆石子，允许任意取走 (或是取走指定数量的石子)，此时再去问你先手是必胜还是必败。</p> <p>这并没有什么难的，我们依然可以将许多堆石子放入多元组来构成一个位置，然后依然可以计算这个位置是<tex>$\mathrm{N}$</tex>点还是<tex>$\mathrm{P}$</tex>点。但是，当石子数量比较多时，这个位置的增长几乎是不可接受的。</p> <p>事实上，即使是多堆石子，它依然可以分解为多个一堆的Nim游戏，每次行动时，玩家可以任意选择其中一个游戏来行动。不妨用<tex>$G_1(V_1, E_1)$</tex>和<tex>$G_2(V_2, E_2)$</tex>两张图来表示两个公平组合游戏，那么定义<tex>$G(V, E) = G_1 + G_2$</tex>为游戏的组合，即新游戏<tex>$G$</tex>可以每一步在<tex>$G_1$</tex>中行动，或是在<tex>$G_2$</tex>中行动。我们需要将两张图加合为一张图，所以对于<tex>$u \in V_1$</tex>和<tex>$v \in V_2$</tex>的两个点，在<tex>$G$</tex>中将变为一个点<tex>$(u, v)$</tex>。同时和<tex>$u$</tex>、<tex>$v$</tex>相关的边都连向这个点。<br /> 可是，多数情况下，我们不会关心这个图是什么样的，因为它实在是太复杂了。但是却有一个很好的性质：</p> <blockquote> <p>(Sprague-Grundy定理)<br /> 令<tex>$G = G_1 + G_2 + \cdots + G_n$</tex>，设<tex>$G_i$</tex>的SG函数为<tex>$g_i$</tex>，<tex>$G$</tex>的SG函数为<tex>$g$</tex>，那么有：<br /> <tex>$$ g(X) = g((x_1, x_2, \dots, x_n)) = g_1(x_1) \oplus g_2(x_2) \oplus \cdots \oplus g_n(x_n) $$</tex></p> <p>其中<tex>$X \in V, x_i \in V_i$</tex>，<tex>$\oplus$</tex>是异或运算。</p> </blockquote> <p><strong>证明</strong>：在这里不再介绍异或了，如果不了解的可以先去看一下。<br /> 根据SG函数的定义，我们只用证明以下两点就可以完成整个定理的证明：<br /> 设<tex>$b = g_1(x_1) \oplus g_2(x_2) \oplus \cdots \oplus g_n(x_n)$</tex>。</p> <ol> <li>对于所有的<tex>$0 \leqslant a \lt b$</tex>，<tex>$X$</tex>一定存在一个可以到达的位置，满足其<tex>$g$</tex>值为<tex>$a$</tex>。 <li>对于所有<tex>$X$</tex>所可以到达的位置，没有<tex>$g$</tex>值为<tex>$b$</tex>。 </ol> <p><strong>证明<tex>$(1)$</tex></strong>：设<tex>$d = a \oplus b$</tex>。设<tex>$d$</tex>的二进制表示的最高位的位置为<tex>$k$</tex>。由于<tex>$a \lt b$</tex>，所以一定有<tex>$a$</tex>的第<tex>$k$</tex>位为<tex>$0$</tex>，并且<tex>$b$</tex>的第<tex>$k$</tex>位为<tex>$1$</tex>。由于<tex>$b = g_1(x_1) \oplus g_2(x_2) \oplus \cdots \oplus g_n(x_n)$</tex>，那么一定存在一个<tex>$g_i(x_i)$</tex>的第<tex>$k$</tex>位为<tex>$1$</tex>。不失一般性，设<tex>$i = 1$</tex>，那么可以知道<tex>$d \oplus g_1(x_1) \lt g_1(x_1)$</tex>，所以存在一个位置<tex>$x^\prime_1$</tex>能够从<tex>$x_1$</tex>转移过来，并且满足<tex>$g_1(x^\prime_1) = d \oplus g_1(x_1)$</tex>。这相当于在<tex>$G_1$</tex>中行动一步，所以<tex>$(x_1, x_2, \dots, x_n)$</tex>也存在一个转移到<tex>$(x^\prime_1, x_2, \dots, x_n)$</tex>的行动，而此时有：<br /> <tex>$$ \begin{aligned} a &amp; = g_1(x^\prime_1) \oplus g_2(x_2) \oplus \cdots \oplus g_n(x_n) \\ &amp; = d \oplus g_1(x_1) \oplus g_2(x_2) \oplus \cdots \oplus g_n(x_n) \\ &amp; = d \oplus b \end{aligned} $$</tex></p> <p>所以<tex>$(1)$</tex>成立。</p> <p><strong>证明<tex>$(2)$</tex></strong>：不失一般性，假设我们在<tex>$G_1$</tex>中从<tex>$x_1$</tex>行动到<tex>$x^\prime_1$</tex>，那么根据SG函数的定义，有<tex>$g_1(x_1) \neq g_1(x^\prime_1)$</tex>，所以<tex>$b \oplus g_1(x_1) \oplus g_1(x^\prime_1) \neq b$</tex>，所以<tex>$(2)$</tex>成立。</p> <p>至此，我们已经成功证明了Sprague-Grundy定理。现在我们尝试将其运用到Nim游戏上：<br /> 首先对于一堆石子的情况，由于取走任意数量不为<tex>$0$</tex>的石子，所以只要不是没有石子，先手可以一次取完。简单推理可以知道<tex>$g(n) = n$</tex>。即只要有石子就先手必胜。<br /> 现在我们有许多堆石子，每一堆石子都可以视为一个Nim游戏，那么这个游戏就是许多Nim游戏加合。根据Sprague-Grundy定理，如果每一堆石子的个数为<tex>$x_i$</tex>，那么SG函数就是：<br /> <tex>$$ \begin{aligned} g((x_1, x_2, \dots, x_n)) &amp; = g(x_1) \oplus g(x_2) \oplus \cdots \oplus g(x_n) \\ &amp; = x_1 \oplus x_2 \oplus \cdots \oplus x_n \end{aligned} $$</tex></p> <p>换言之，如果每堆石子数异或起来如果不为<tex>$0$</tex>，那么先手就必胜，否则将会必败。这确实是一个非常神奇的结论。同时，结合之前关于<tex>$\mathrm{N}$</tex>点和<tex>$\mathrm{P}$</tex>的一些讨论，我们知道只要能使异或和变为<tex>$0$</tex>的操作就是我们的先手必胜策略。</p> <div class=footnote > <hr /> <ol> <li id="fn:n-and-p"> <p>N意为&rdquo;Next&rdquo;，即执行这一步的人会赢。P意为&rdquo;Previous&rdquo;，即执行上一步的人会赢。&#160;<a class=footnote-backref  href="#fnref:n-and-p" rev=footnote  title="Jump back to footnote 1 in the text">&#8617;</a></p> </ol> </div> <hr/> <div id=comments ></div> <script> window.addEventListener('load', () => { quicklink(); }); const gitment = new Gitment({id: '0c7a8e70f72d33828211f85a848cd219', owner: 'riteme', repo: 'riteme.github.io', oauth: { client_id: 'd4fcffa25858a7a58e1a', client_secret: 'e0c8e08beb95497871f8355416c69390634cec76' }, perPage: 10, }); gitment.render('comments'); </script> </div> </div> <div class="mdl-cell sidebar"> <div class=article > <div class="mdl-card mdl-shadow--2dp sidebar-card"> <div class="mdl-card__actions sidebar-title">页面信息</div> <div class=mdl-card__supporting-text > 标签: <a href="/search.html?q=公平组合游戏"><span class=label >公平组合游戏</span></a> <a href="/search.html?q=Sprague-Grundy定理"><span class=label >Sprague-Grundy定理</span></a> <a href="/search.html?q=SG函数"><span class=label >SG函数</span></a> <a href="/search.html?q=博弈论"><span class=label >博弈论</span></a><br/> 创建时间: 2016.12.30<br/> 上次修改: 2016.12.30<br/> 字数统计: 4762 字 / 约 19 分钟 </div> </div> <br/> <div class="mdl-card mdl-shadow--2dp sidebar-card"> <div class="mdl-card__actions sidebar-title">目录</div> <div class=mdl-card__supporting-text > <div class=toc > <ul> <li><a href="#_1">公平组合游戏</a><ul> <li><a href="#_2">定义</a> <li><a href="#nim">简单Nim游戏</a> <li><a href="#_3">必胜与必败</a> <li><a href="#_4">图的表示</a> <li><a href="#sprague-grundy">Sprague-Grundy定理</a> </ul> </ul> </div> </div> </div> <br/> <div class="mdl-card mdl-shadow--2dp sidebar-card"> <div class="mdl-card__actions sidebar-title">数学公式渲染</div> <div class=mdl-card__supporting-text > <form name=mathopt > <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for=option-1 > <input type=radio  id=option-1  class=mdl-radio__button  name=sel  value=mathjax > <span class=mdl-radio__label >MathJax (推荐)</span> </label><br/> <div id=tip-1 > <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for=option-2 > <input type=radio  id=option-2  class=mdl-radio__button  name=sel  value=katex > <span class=mdl-radio__label >KaTeX</span> </label> </div> <div id=tip-2 > <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for=option-3 > <input type=radio  id=option-3  class=mdl-radio__button  name=sel  value="katex&mathjax"> <span class=mdl-radio__label >Mixed</span> </label> </div> </form> </div> </div> <div class=mdl-tooltip  data-mdl-for=tip-1 >KaTeX 渲染效率很高，但是目前 KaTeX 容错性不强，因此使用 KaTeX 时可能会存在一些数学公式无法渲染的情况</div> <div class=mdl-tooltip  data-mdl-for=tip-2 >先使用 KaTeX 渲染，再使用 MathJax 渲染</div> <br/> <div class="nano mdl-card mdl-shadow--2dp sidebar-card"> <a class=nano-ref  target=_new  href="http://nichijou.wikia.com/wiki/Nano_Shinonome"></a> <div class=mdl-card__actions > <div class=nano-shell ><span class=shell-start >$</span> nano <a href="https://github.com/riteme/riteme.github.io/blob/master/blog/2016-12-30/sg.md" id=nano-link >sg.md</a></div> </div> </div> <div class=mdl-tooltip  data-mdl-for=nano-link >查看原始 Markdown 文档</div> </div> </div> </div> <footer class=mdl-mega-footer > <div class=mdl-mega-footer__middle-section > <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h1 class=mdl-mega-footer__heading >RITEME.SITE</h1><del>一个从不乱说话的博客</del> </div> <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h1 class=mdl-mega-footer__heading >POWERED BY</h1> <ul class=mdl-mega-footer__link-list > <li><a href="http://pythonhosted.org/Markdown/">Python Markdown</a> <li><a href="http://getmdl.io/">Material Design Lite</a> <li><a href="http://www.tipue.com/search/">Tipuesearch</a> <li><a href="http://www.mathjax.org/">MathJax</a> & <a href="http://khan.github.io/KaTeX/">KaTeX</a> <li><a href="https://github.com/imsun/gitment">Gitment</a> </ul> </div> <div class=mdl-mega-footer__drop-down-section > <input class=mdl-mega-footer__heading-checkbox  type=checkbox  checked> <h1 class=mdl-mega-footer__heading >友情链接</h1> <ul class=mdl-mega-footer__link-list > <li><a href="http://ruanx.pw/">ruanxingzhi</a> <li><a href="https://blog.xehoth.cc/">xehoth</a> <li><a href="http://hjwjbsr.is-programmer.com/">HJWJBSR</a> <li><a href="http://www.micdz.cn/">MicDZ</a> <li><a href="https://cmxrynp.github.io/">CMXRYNP</a> <li><a href="http://memset0.cn/">memset0</a> </ul> </div> </div> <div class=mdl-mega-footer__bottom-section >Theme based on <a href="https://getmdl.io/">MDL</a> | Copyright © 2015-2019 riteme. All rights reserved.</div> </footer> </main> </div>